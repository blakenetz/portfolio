---
import type { HTMLAttributes } from "astro/types";
import IconButton from "~/components/IconButton.astro";
import Flower from "~/assets/flower.svg";
import Link from "~/components/Link.astro";
export interface BackgroundProps extends HTMLAttributes<"main"> {
  showCheckerboard?: boolean;
  showNav?: boolean;
}

const {
  showCheckerboard,
  showNav,
  class: className,
  ...props
} = Astro.props as BackgroundProps;

const paths = Astro.url.pathname.split("/").filter(Boolean);
---

<section id="background" class="fixed inset-0 -z-10"></section>
{showCheckerboard && <section id="checkerboard" class="fixed inset-0 -z-10" />}
<div
  id="noise"
  class="bg-size-200 pointer-events-none fixed -inset-[150%] h-[400%] w-[400%] bg-repeat opacity-15"
>
</div>
<main
  {...props}
  class:list={[
    "fixed inset-0 cursor-default overflow-hidden",
    { "p-checkerboard-size": showCheckerboard },
    { "h-100dvh w-100dvw": showCheckerboard },
    className,
  ]}
>
  <div class="h-full overflow-auto">
    {
      showNav && (
        <header class="font-barriecito text-dodger-blue fixed inset-2 z-10 flex h-fit w-fit items-center gap-2 text-2xl font-extrabold">
          <IconButton as="a" href="/" bg="dodger-blue">
            <Flower class="h-6 w-6 stroke-white" />
          </IconButton>
          <span>/</span>
          {paths.map((path, i) =>
            i === paths.length - 1 ? (
              <span>{path}</span>
            ) : (
              <Fragment>
                <Link href={`/${path}`} class="text-dodger-blue">
                  {path}
                </Link>
                <span>/</span>
              </Fragment>
            ),
          )}
        </header>
      )
    }
    <slot />
  </div>
</main>
<section id="cursor" class="pointer-events-none fixed inset-0"></section>

<style>
  #noise {
    animation: noise-anim 4s steps(8) infinite;
    background: url(/noise.png);
  }

  @keyframes noise-anim {
    0% {
      transform: translate(0, 0);
    }
    25% {
      transform: translate(-10%, 5%);
    }
    50% {
      transform: translate(5%, -10%);
    }
    75% {
      transform: translate(-5%, 10%);
    }
    100% {
      transform: translate(0, 0);
    }
  }
</style>

<script>
  import {
    BlobBackgroundCanvas,
    CheckerboardBackgroundCanvas,
    CursorCanvas,
  } from "~/lib/canvas.client";

  if (document.getElementById("checkerboard")) {
    new CheckerboardBackgroundCanvas("checkerboard");
  }

  new BlobBackgroundCanvas("background");
  new CursorCanvas("cursor");
</script>
