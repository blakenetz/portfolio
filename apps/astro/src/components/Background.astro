---
import type { HTMLAttributes } from "astro/types";

export interface BackgroundProps extends HTMLAttributes<"main"> {
  showCheckerboard?: boolean;
}

const {
  showCheckerboard,
  class: className,
  ...props
} = Astro.props as BackgroundProps;
---

<section id="background" class="fixed inset-0 -z-10"></section>
{showCheckerboard && <section id="checkerboard" class="fixed inset-0 -z-10" />}
<div
  id="noise"
  class="bg-size-200 pointer-events-none fixed -inset-[150%] h-[400%] w-[400%] bg-repeat opacity-15"
>
</div>
<main
  {...props}
  class:list={[
    "fixed inset-0 cursor-default overflow-hidden",
    { "p-checkerboard-size": showCheckerboard },
    { "h-100dvh w-100dvw": showCheckerboard },
    className,
  ]}
>
  <div class="h-full overflow-auto">
    <slot />
  </div>
</main>
<section id="cursor" class="pointer-events-none fixed inset-0"></section>

<style>
  #noise {
    animation: noise-anim 4s steps(8) infinite;
    background: url(/noise.png);
  }

  @keyframes noise-anim {
    0% {
      transform: translate(0, 0);
    }
    25% {
      transform: translate(-10%, 5%);
    }
    50% {
      transform: translate(5%, -10%);
    }
    75% {
      transform: translate(-5%, 10%);
    }
    100% {
      transform: translate(0, 0);
    }
  }
</style>

<script>
  import {
    BlobBackgroundCanvas,
    CheckerboardBackgroundCanvas,
    CursorCanvas,
  } from "~/lib/canvas.client";

  if (document.getElementById("checkerboard")) {
    new CheckerboardBackgroundCanvas("checkerboard");
  }

  new BlobBackgroundCanvas("background");
  new CursorCanvas("cursor");
</script>
